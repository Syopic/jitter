angular.module("sara").controller("DashboardCtrl",["$scope","$rootScope","$state","$window","$controller","ServiceData","$location","$timeout","$stateParams","DataFactory","$filter",function(e,t,n,i,a,s,d,o,r,c,l){function u(t,n){e.cahrtIndicator=t,e.selectedIndicator=e.selectIndicator=n,e.multiselectData=t,oneData=[],e.labels.splice(0);n.code;var i=n.index;return angular.forEach(e.Data.regions,function(t,n){t.name.length>16?e.labels.push(l("limitTo")(t.name,16)+"..."):e.labels.push(t.name),null==t.indexes[i].value?oneData.push(0):oneData.push(t.indexes[i].value)}),oneData}function y(t){n.go("root.dashboard",{continent:e.continent,country:e.country,disease:e.disease,type:e.type,year:e.year},{notify:t})}e.continent=r.continent?r.continent:"Africa",e.country=r.country?r.country:"Kenya",e.disease=r.disease?r.disease:"HIV",e.type=r.type?r.type:"SARA",e.year=r.year?r.year:"2010",e.years=s.collections.Years,e.selectedYear=e.year,e.selectedDisease=e.disease,e.selectedHFA=e.type,isUpdate=!1,y(!1),e.expanded=!0,e.series=[],e.labels=[],e.data=[];var g=1;switch(e.Data={},e.selectedDisease){case"HIV":e.ind=s.diseaseIndicatorsDirectory.HIV;break;case"TB":e.ind=s.diseaseIndicatorsDirectory.TB;break;case"Malaria":e.ind=s.diseaseIndicatorsDirectory.Malaria;break;default:e.ind=s.diseaseIndicatorsDirectory.HIV}e.seriesID=[],e.cahrtIndicator=e.ind,e.selectIndicator=e.ind[0],e.selectedIndicator=e.ind[0],e.selectIndicatorMap=e.ind[0],e.series=[e.selectIndicator.name],e.hfaSel=1,e.isNoData=!1,e.chartSize={display:"block",width:"1210px",height:"403px"},function(){var t={disease:e.disease,type:e.type,country:e.country,year:e.year};e.isPendinggData=!0,e.isNoData=!1,c.getRegions(t).then(function(t){e.multiselectModel.splice(0),g=1,e.series=[],e.labels=[],e.Data=t.data.data,null==e.Data?(e.isPendinggData=!1,e.isNoData=!0):(e.data=[u(e.ind,e.ind[0])],e.seriesID[0]=[{count:0,name:e.ind[0].name}],e.legend=s.getLegend(e.disease,e.ind[0].index),e.series=["["+e.ind[0].code+"] "+e.legend+" "+e.ind[0].name],e.labels.length<=35?(e.chartSize={width:"1210px",height:"100%"},e.chartHeight=100):e.labels.length>35&&(e.chartSize={width:"1800px",height:"100%"},e.chartHeight=67),e.isPendinggData=!1)})}(),e.onSellectDisease=function(){switch(e.selectedDisease){case"HIV":e.ind=s.diseaseIndicatorsDirectory.HIV;break;case"TB":e.ind=s.diseaseIndicatorsDirectory.TB;break;case"Malaria":e.ind=s.diseaseIndicatorsDirectory.Malaria}},e.multiselectModel=[],e.multiselectData=e.ind,e.multiselectSettings={showCheckAll:!1,styleActive:!1,buttonClasses:"btn btn-info",selectionLimit:3,template:'{{"["+option.code+"] " + option.name}}',scrollableHeight:"300px",scrollable:!0,closeOnSelect:!0,groupByTextProvider:function(t){return s.getLegendByGroup(e.disease,t)},groupBy:"group"},e.multiselectEvents={onItemSelect:function(t){!function(t){switch(g){case 1:e.series=[],e.legend=s.getLegend(e.disease,t.index),e.series=["["+t.code+"] "+e.legend+" "+t.name],e.seriesID[0]=[{count:0,name:t.name}],e.data=[u(e.ind,t)];break;case 2:e.legend=s.getLegend(e.disease,t.index),e.series.push(["["+t.code+"] "+e.legend+" "+t.name]),e.seriesID[1]=[{count:1,name:t.name}],e.data.push(u(e.ind,t));break;case 3:e.legend=s.getLegend(e.disease,t.index),e.series.push(["["+t.code+"] "+e.legend+" "+t.name]),e.seriesID[2]=[{count:2,name:t.name}],e.data.push(u(e.ind,t));break;default:e.data=[u(e.ind,e.ind[0])],e.legend=s.getLegend(e.disease,e.ind[0].index),e.series=["["+e.ind[0].code+"] "+e.legend+" "+e.ind[0].name]}}(t),3==++g&&(g=3)},onItemDeselect:function(t){g--;for(var n=0;n<e.series.length&&1!=e.series.length;n++)e.seriesID[n][0].name==t.name&&(e.series.splice(n,1),e.data.splice(n,1),e.seriesID.splice(n,1))},onDeselectAll:function(){e.series=[],g=1,e.data=[u(e.ind,e.ind[0])],e.legend=s.getLegend(e.disease,e.ind[0].index),e.series=["["+e.ind[0].code+"] "+e.legend+" "+e.ind[0].name],e.seriesID[0]=[{count:0,name:e.ind[0].name}]}},e.colors=[{backgroundColor:"#0288d1",borderColor:"#0288d1",yAxisID:"y-axis-1"},{backgroundColor:"#d50000",borderColor:"#d50000",yAxisID:"y-axis-2"},{backgroundColor:"#dbb820",borderColor:"#dbb820",yAxisID:"y-axis-3"}],e.options={animation:!1,responsive:!0,layout:{padding:{left:10,righ:10,bottom:5}},legend:{display:!0,onClick:function(e,t){},labels:{boxWidth:12}},scales:{xAxes:[{gridLines:{display:!1},ticks:{autoSkip:!1,fontSize:12,backdropPaddingX:15,backdropPaddingY:15}}],yAxes:[{gridLines:{display:!0},type:"linear",id:"y-axis-1",display:!0,position:"left",suggestedMin:0,ticks:{beginAtZero:!0,max:100,callback:function(e,t,n){return e.toFixed(0)}}},{type:"linear",id:"y-axis-2",display:!1,position:"left",ticks:{beginAtZero:!0,callback:function(e,t,n){return e.toFixed(0)}}},{type:"linear",id:"y-axis-3",display:!1,position:"left",ticks:{beginAtZero:!0,callback:function(e,t,n){return e.toFixed(0)}}}]},tooltips:{mode:"index",intersect:!1,callbacks:{label:function(e,t){var n=t.datasets[e.datasetIndex].data[e.index]||0,i=t.labels[e.index];return e.datasetIndex,n+" in District "+i}}}},e.viewTable=function(){var t=n.href("root.datatable",{continent:e.continent,country:e.country,disease:e.disease,type:e.type,year:e.year,mode:0});i.open(t,"_blank")},c.getContinents().then(function(t){e.continents=t.data.continents,e.selectedContinent=e.continents.filter(function(t){return t.name==e.continent})[0]}),e.$watch("selectedContinent",function(){e.selectedContinent&&c.getCountries(e.selectedContinent.name).then(function(t){e.countries=t.data.countries,e.selectedCountry=e.countries.filter(function(t){return t.name==e.country})[0],e.selectedCountry||(e.selectedCountry=e.countries[0])})}),e.applyForm=function(){e.continent=e.selectedContinent.name,e.country=e.selectedCountry.name,e.type=e.selectedHFA,e.disease=e.selectedDisease,e.year=e.selectedYear,y(!0)},angular.extend(this,a("MapCtrl",{$scope:e}))}]);